FROM ubuntu:latest

# ç’°å¢ƒå¤‰æ•°ã§ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³è¨­å®šã‚’è‡ªå‹•åŒ–
ENV DEBIAN_FRONTEND=noninteractive

# curlã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
RUN apt-get update && apt-get upgrade -y && \
    apt-get install -y --no-install-recommends \
    software-properties-common \
    build-essential \
    curl \
    && add-apt-repository ppa:deadsnakes/ppa && \
    apt-get update
# Pythonã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN apt-get install -y --no-install-recommends \
    python3.11\
    python3.11-venv \
    python3.11-dev \
    python3-pip

# Python3 ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® `python` ã‚³ãƒãƒ³ãƒ‰ã«è¨­å®š
RUN update-alternatives --install /usr/bin/python python /usr/bin/python3.11 1 && \
    update-alternatives --install /usr/bin/pip pip /usr/bin/pip3 1

# node_modulesã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN apt install -y nodejs npm && npm install n -g \
    && n stable \
    && apt purge -y nodejs npm \
    && apt autoremove -y \
    && n stable


# manimã‚³ãƒ¼ãƒ‰ã‚’å‹•ã‹ã™ãŸã‚ã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚
# latexç’°å¢ƒã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN apt update && apt upgrade -y && \
apt install -y wget
RUN apt-get update && apt-get install -y texlive texlive-latex-extra && apt-get clean
# ffmpegã‚’å…¥ã‚Œã‚‹
RUN apt-get install -y xz-utils
RUN wget https://johnvansickle.com/ffmpeg/builds/ffmpeg-git-amd64-static.tar.xz \
    && tar xvf ./ffmpeg-git-amd64-static.tar.xz \
    && cp ./ffmpeg*amd64-static/ffmpeg /usr/local/bin/
RUN apt update
RUN apt install -y cmake pkg-config libcairo2-dev libgirepository1.0-dev build-essential libpangocairo-1.0-0 libpango1.0-dev libcairo2-dev xdg-utils


# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºã‚’å°ã•ãã™ã‚‹ã€‚
RUN apt-get clean && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /workspaces/

# gitã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
RUN apt-get update && apt-get install -y git


# ================================================
# ğŸŸ¢ pnpmï¼ˆãƒ¢ãƒ€ãƒ³Nodeãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ï¼‰ã®å°å…¥
# ================================================
RUN npm install -g corepack && corepack enable && \
    corepack prepare pnpm@latest --activate

# ç¢ºèªï¼ˆä»»æ„ï¼‰
RUN node -v && pnpm -v

# ================================================
# ğŸ uvï¼ˆRustè£½ã®è¶…é«˜é€ŸPythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ï¼‰
# ================================================
RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH="/root/.cargo/bin:$PATH"

